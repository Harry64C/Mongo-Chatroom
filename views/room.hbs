<script>var path = "/room/{{id}}"</script>

<div class = "container">
    <h1>{{ roomName }}</h1>

    <div class = "row">
        <div class = "col 8">
            <div class = "content">
                <h3>Post a new message</h3>
                
                <form action = "http://localhost:8080/message" method = "POST">

                    <div class = "form-group">
                        <label for = "message">
                            Message
                        </label>
                        <input class = "form-control" name = "message" id = "message" onInput = "sendMessage()">
                    </div>

                    <div class = "hidden">

                        <div class = "form-group">
                            <input class = "form-control" name = "time" value = {{ time }}>
                        </div>

                        <div class = "form-group">
                            <input class = "form-control" name = "roomID" value = {{ id }}>
                        </div>

                        <div class = "form-group">
                            <input class = "form-control" name = "nickname" id = "nickname">
                        </div>

                    </div>


                    <button type = "submit" class = "btn btn-primary">Submit</button>
                </form>

                
            </div>
        </div>

        <div class = "col 4">
            <div class = "content">
                <h3>Logged in as:</h3>
                <p id = "username"></p>
                
                <div class = "form-group">
                    <input class = "form-control" onInput = "changeUsername(this.value)">
                </div>
            </div>

            <div class = "content">
                <h3>Search Messages</h3>
                
                <div class = "form-group">
                    <input class = "form-control" onInput = "searchMessages(this.value)">
                    <a type = "button" id = "searchBtn" class = "btn btn-primary" href = '#'> Submit</a>
                </div>
            </div>


        </div>


    </div>


    <div class = "content">
        <h3>Messages</h3>
        {{#if isAvailable}}
            <div class="row">
            {{#each chats}} <!-- Goes through each chat ("this") in chats-->                    
                <div class = "card">
                    <div class = "card-body">
                        <h5 class = "card-title">{{this.nickname}} at {{this.time}}pm:</h5>
                        <p class = "card-body card-text">{{this.message}}</p>
                    </div>
                </div>
            
            {{/each}}
            </div>

        {{/if}}


    </div>
</div>


<script>
    function sendMessage() {
        let user = document.getElementById('username').innerHTML;
        console.log(user);
        if (!user) {
            alert("log in before posting!");
            document.getElementById('message').value = '';
        }
    }

    function changeUsername(value) {
        document.getElementById('username').innerHTML = value;
        document.getElementById('nickname').value = value;
    }

    function searchMessages(value) {
        if (value) {
            path = "/room/{{id}}?search=" + value;
            document.getElementById('searchBtn').href = path;
        }
        else {
            path = "/room/{{id}}";
        }
        document.getElementById('searchBtn').href = path;
    }


    
</script>

